databaseChangeLog:
  - changeSet:
      id: 11-03-2025-1
      author: Dima
      comment: "Create table Users"
      changes:
        - createTable:
            tableName: users
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: username
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: firstname
                  type: VARCHAR(255)
              - column:
                  name: lastname
                  type: VARCHAR(255)
              - column:
                  name: email
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: password
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: role_type
                  type: VARCHAR(50)
                  constraints:
                    nullable: true
  - changeSet:
      id: 30-03-2025-6
      author: nathalie_mac
      comment: "Add indexes and constraints on Users"
      changes:
        - addCheckConstraint:
            tableName: users
            constraintName: ck_users_username
            constraintBody: "LENGTH(username) BETWEEN 8 AND 25"
        - addNotNullConstraint:
            tableName: users
            columnName: firstname
        - addCheckConstraint:
            tableName: users
            constraintName: ck_users_firstname
            constraintBody: "firstname ~ '^[A-ZА-ЯЁ][a-zа-яё]+$' AND (LENGTH(firstname) BETWEEN 1 AND 25)"
        - addNotNullConstraint:
            tableName: users
            columnName: lastname
        - addCheckConstraint:
            tableName: users
            constraintName: ck_users_lastname
            constraintBody: "lastname ~ '^[A-ZА-ЯЁ][a-zа-яё]+$' AND (LENGTH(lastname) BETWEEN 1 AND 25)"
        - addUniqueConstraint:
            tableName: users
            columnNames: email
            constraintName: uk_users_email
        - addCheckConstraint:
            tableName: users
            constraintName: ck_users_email
            constraintBody: "LENGTH(email) BETWEEN 11 and 50"
        - addCheckConstraint:
            tableName: users
            constraintName: ck_users_password
            constraintBody: "LENGTH(password) BETWEEN 15 and 20"
        - addCheckConstraint:
            tableName: users
            constraintName: ck_users_role_type
            constraintBody: "role_type IN ('FRONTEND', 'BACKEND', 'FULLSTACK', 'MANAGER', 'DESIGNER')"
        - createIndex:
            tableName: users
            indexName: users_email_hidx
            columns:
              - column:
                  name: email
        - createIndex:
            tableName: users
            indexName: users_username_hidx
            columns:
              - column:
                  name: username

  - changeSet:
      id: 11-03-2025-2
      author: Dima
      comment: "Create table Tokens"
      changes:
        - createTable:
            tableName: tokens
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: access_token
                  type: VARCHAR(255)
              - column:
                  name: refresh_token
                  type: VARCHAR(255)
              - column:
                  name: is_logged_out
                  type: BOOLEAN
                  defaultValue: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_token_user_id
                    references: users(id)
  - changeSet:
      id: 11-03-2025-3
      author: Dima
      comment: "Create table ResetCodes"
      changes:
        - createTable:
            tableName: reset_codes
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: reset_code
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: expire_time
                  type: TIMESTAMP
                  constraints:
                    nullable: false
              - column:
                  name: user_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_reset_codes_user_id
                    references: users(id)

  - changeSet:
      id: 30-03-2025-7
      comment: "Add indexes and constraints on Tokens"
      author: nathalie_mac
      changes:
        - addNotNullConstraint:
            tableName: tokens
            columnName: access_token
        - addNotNullConstraint:
            tableName: tokens
            columnName: refresh_token
        - addNotNullConstraint:
            tableName: tokens
            columnName: is_logged_out
        - createIndex:
            tableName: tokens
            indexName: tokens_access_token_hidx
            columns:
              - column:
                  name: access_token
        - createIndex:
            tableName: tokens
            indexName: tokens_refresh_token_hidx
            columns:
              - column:
                  name: refresh_token
        - createIndex:
            tableName: tokens
            indexName: tokens_user_id_hidx
            columns:
              - column:
                  name: user_id

  - changeSet:
      id: 30-03-2025-8
      comment: "Add indexes on ResetCodes"
      author: nathalie_mac
      changes:
        - createIndex:
            tableName: reset_codes
            indexName: reset_codes_reset_code_hidx
            columns:
              - column:
                  name: reset_code
        - createIndex:
            tableName: reset_codes
            indexName: reset_codes_expire_time_hidx
            columns:
              - column:
                  name: expire_time
        - createIndex:
            tableName: reset_codes
            indexName: reset_codes_user_id_hidx
            columns:
              - column:
                  name: user_id